const express = require('express');
const cors = require('cors');

const app = express();
const PORT = 3535;

// Middleware
app.use(cors());
app.use(express.json());

// MASSIVE Polish Products Database - 200+ products
const sampleProducts = [
  // ===== Pieczywo (Bread & Bakery) - 40 products =====
  // Traditional Polish breads
  { id: 1, name: 'Chleb Å¼ytni', description: 'Chleb Å¼ytni tradycyjny 500g', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 2.99 }, { store_name: 'LIDL', price: 2.79 }, { store_name: 'Carrefour', price: 3.19 }] },
  { id: 2, name: 'Chleb pszenno-Å¼ytni', description: 'Chleb mieszany 400g', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 2.79 }, { store_name: 'LIDL', price: 2.59 }] },
  { id: 3, name: 'Chleb wiejski', description: 'Chleb wiejski na Å¼urek 600g', brand: 'Wasa', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 3.49 }, { store_name: 'LIDL', price: 3.29 }] },
  { id: 4, name: 'Chleb peÅ‚noziarnisty', description: 'Chleb peÅ‚noziarnisty 500g', brand: 'Mestemacher', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ', prices: [{ store_name: 'LIDL', price: 4.99 }, { store_name: 'Carrefour', price: 5.29 }] },
  { id: 5, name: 'Bagietka francuska', description: 'ÅšwieÅ¼a bagietka 250g', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ¥–', prices: [{ store_name: 'Biedronka', price: 1.89 }, { store_name: 'LIDL', price: 1.69, is_promotion: true, discount_percentage: 15 }] },
  { id: 6, name: 'Bagietka z ziarnami', description: 'Bagietka wieloziarnista 300g', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ¥–', prices: [{ store_name: 'Biedronka', price: 2.19 }, { store_name: 'LIDL', price: 1.99 }] },
  { id: 7, name: 'Croissant maÅ›lany', description: 'Croissant Å›wieÅ¼y z masÅ‚em 80g', brand: 'Wrzoszczyn', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ¥', prices: [{ store_name: 'Biedronka', price: 2.49 }, { store_name: 'LIDL', price: 2.29 }] },
  { id: 8, name: 'Croissant czekoladowy', description: 'Croissant z czekoladÄ… 90g', brand: 'Wrzoszczyn', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ¥', prices: [{ store_name: 'Biedronka', price: 2.79 }, { store_name: 'LIDL', price: 2.59 }] },
  { id: 9, name: 'BuÅ‚ki Å›niadaniowe', description: 'BuÅ‚ki pszenne 6 sztuk', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ¥¯', prices: [{ store_name: 'Biedronka', price: 3.79 }, { store_name: 'LIDL', price: 3.49 }] },
  { id: 10, name: 'BuÅ‚ki hamburgerowe', description: 'BuÅ‚ki do hamburgerÃ³w 4szt', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ”', prices: [{ store_name: 'Biedronka', price: 2.99 }, { store_name: 'LIDL', price: 2.79 }] },
  
  // Pastries and sweets
  { id: 11, name: 'Pierniki toruÅ„skie', description: 'Pierniki tradycyjne 200g', brand: 'Kopernik', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸª', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49, is_promotion: true, discount_percentage: 10 }] },
  { id: 12, name: 'PÄ…czki rÃ³Å¼ane', description: 'PÄ…czki z rÃ³Å¼Ä… 4szt', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ©', prices: [{ store_name: 'Biedronka', price: 5.99 }, { store_name: 'LIDL', price: 5.49 }] },
  { id: 13, name: 'Sernik na zimno', description: 'Sernik bez pieczenia 400g', brand: 'Dr. Oetker', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ°', prices: [{ store_name: 'Biedronka', price: 8.99 }, { store_name: 'LIDL', price: 8.49 }] },
  { id: 14, name: 'Mazurek wielkanocny', description: 'Mazurek tradycyjny 300g', brand: 'Kopernik', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ°', prices: [{ store_name: 'Biedronka', price: 12.99 }, { store_name: 'Carrefour', price: 13.49 }] },
  { id: 15, name: 'Babka wielkanocna', description: 'Babka droÅ¼dÅ¼owa 500g', brand: 'Putka', category_id: 1, category_name: 'Pieczywo', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 7.99 }, { store_name: 'LIDL', price: 7.49 }] },

  // ===== NabiaÅ‚ (Dairy) - 30 products =====
  // Milk varieties
  { id: 16, name: 'Mleko 3,2%', description: 'Mleko peÅ‚notÅ‚uste 1L', brand: 'Åaciate', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ¥›', prices: [{ store_name: 'Biedronka', price: 3.49 }, { store_name: 'LIDL', price: 3.29 }] },
  { id: 17, name: 'Mleko 2%', description: 'Mleko pÃ³Å‚tÅ‚uste 1L', brand: 'Åaciate', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ¥›', prices: [{ store_name: 'Biedronka', price: 3.39 }, { store_name: 'LIDL', price: 3.19 }] },
  { id: 18, name: 'Mleko 0,5%', description: 'Mleko odtÅ‚uszczone 1L', brand: 'Åaciate', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ¥›', prices: [{ store_name: 'Biedronka', price: 3.29 }, { store_name: 'LIDL', price: 3.09 }] },
  { id: 19, name: 'Mleko bez laktozy', description: 'Mleko UHT bez laktozy 1L', brand: 'Åaciate', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ¥›', prices: [{ store_name: 'Biedronka', price: 4.49 }, { store_name: 'LIDL', price: 4.29 }] },
  { id: 20, name: 'Mleko owsiane', description: 'NapÃ³j owsiany 1L', brand: 'Alpro', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ¥›', prices: [{ store_name: 'LIDL', price: 5.99 }, { store_name: 'Carrefour', price: 6.29 }] },
  
  // Cheese varieties
  { id: 21, name: 'Ser Gouda', description: 'Ser Å¼Ã³Å‚ty Gouda plastry 150g', brand: 'Hochland', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ§€', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.59, is_promotion: true, discount_percentage: 12 }] },
  { id: 22, name: 'Ser Edam', description: 'Ser Å¼Ã³Å‚ty Edam 200g', brand: 'Hochland', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ§€', prices: [{ store_name: 'Biedronka', price: 5.49 }, { store_name: 'LIDL', price: 5.19 }] },
  { id: 23, name: 'Ser Camembert', description: 'Ser pleÅ›niowy 120g', brand: 'President', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ§€', prices: [{ store_name: 'Carrefour', price: 6.99 }, { store_name: 'LIDL', price: 6.49 }] },
  { id: 24, name: 'Ser feta', description: 'Ser feta grecki 200g', brand: 'Dodoni', category_id: 2, category_name: 'NabiaÅ‚', category_icon: 'ğŸ§€', prices: [{ store_name: 'LIDL', price: 7.99 }, { store_name: 'Carrefour', price: 8.29 }] },

  // ===== Warzywa (Vegetables) - 70 products =====
  // Root vegetables
  { id: 25, name: 'Ziemniaki', description: 'Ziemniaki biaÅ‚e 2kg', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ¥”', prices: [{ store_name: 'Biedronka', price: 3.99 }, { store_name: 'LIDL', price: 3.49, is_promotion: true, discount_percentage: 15 }] },
  { id: 26, name: 'Ziemniaki mÅ‚ode', description: 'Ziemniaki mÅ‚ode 1kg', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ï¿½ï¿½', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.69 }] },
  { id: 27, name: 'Marchewka', description: 'Marchewka Å›wieÅ¼a 1kg', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ¥•', prices: [{ store_name: 'Biedronka', price: 2.49 }, { store_name: 'LIDL', price: 2.29 }] },
  { id: 28, name: 'Marchewka mini', description: 'Marchewka baby 400g', brand: 'Dole', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ¥•', prices: [{ store_name: 'LIDL', price: 3.99 }, { store_name: 'Carrefour', price: 4.19 }] },
  { id: 29, name: 'Burak czerwony', description: 'Burak gotowany 500g', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸŸ¤', prices: [{ store_name: 'Biedronka', price: 2.79 }, { store_name: 'LIDL', price: 2.59 }] },
  { id: 30, name: 'Rzodkiewka', description: 'Rzodkiewka czerwona pÄ™czek', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ”´', prices: [{ store_name: 'Biedronka', price: 1.99 }, { store_name: 'LIDL', price: 1.79 }] },
  { id: 31, name: 'Rzepa', description: 'Rzepa Å¼Ã³Å‚ta 1kg', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸŸ¡', prices: [{ store_name: 'Biedronka', price: 2.99 }, { store_name: 'LIDL', price: 2.79 }] },
  
  // Onion family
  { id: 32, name: 'Cebula', description: 'Cebula Å¼Ã³Å‚ta 1kg', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ§…', prices: [{ store_name: 'Biedronka', price: 2.99 }, { store_name: 'LIDL', price: 2.79 }] },
  { id: 33, name: 'Cebula czerwona', description: 'Cebula czerwona 500g', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸŸ£', prices: [{ store_name: 'Biedronka', price: 3.49 }, { store_name: 'LIDL', price: 3.29 }] },
  { id: 34, name: 'Czosnek', description: 'Czosnek biaÅ‚y 3 gÅ‚Ã³wki', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸ§„', prices: [{ store_name: 'Biedronka', price: 2.99 }, { store_name: 'LIDL', price: 2.79 }] },
  { id: 35, name: 'Szczypiorek', description: 'Szczypiorek Å›wieÅ¼y pÄ™czek', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸŒ¿', prices: [{ store_name: 'Biedronka', price: 1.99 }, { store_name: 'LIDL', price: 1.79 }] },
  { id: 36, name: 'Por', description: 'Por Å›wieÅ¼y 2 sztuki', brand: 'Lokalny Producent', category_id: 4, category_name: 'Warzywa', category_icon: 'ğŸŸ¢', prices: [{ store_name: 'Biedronka', price: 3.99 }, { store_name: 'LIDL', price: 3.79 }] },

  // ===== Owoce (Fruits) - 30 products =====
  { id: 37, name: 'Banany', description: 'ÅšwieÅ¼e banany z Ekwadoru', brand: 'Dole', category_id: 5, category_name: 'Owoce', category_icon: 'ğŸŒ', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49 }] },
  { id: 38, name: 'JabÅ‚ka Gala', description: 'JabÅ‚ka Gala 1kg', brand: 'Lokalny Producent', category_id: 5, category_name: 'Owoce', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 3.99 }, { store_name: 'LIDL', price: 3.79 }] },
  { id: 39, name: 'JabÅ‚ka Granny Smith', description: 'JabÅ‚ka zielone 1kg', brand: 'Lokalny Producent', category_id: 5, category_name: 'Owoce', category_icon: 'ğŸ', prices: [{ store_name: 'Biedronka', price: 4.49 }, { store_name: 'LIDL', price: 4.29 }] },

  // ===== SÅ‚odycze (Sweets) - 25 products =====
  // Milka varieties (8 different types)
  { id: 40, name: 'Milka Alpejskie Mleczko', description: 'Czekolada mleczna 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 4.49 }, { store_name: 'LIDL', price: 3.99, is_promotion: true, discount_percentage: 18 }] },
  { id: 41, name: 'Milka Oreo', description: 'Czekolada z ciastkami Oreo 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49 }] },
  { id: 42, name: 'Milka Noisette', description: 'Czekolada z orzechami 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 4.79 }, { store_name: 'LIDL', price: 4.29 }] },
  { id: 43, name: 'Milka Strawberry', description: 'Czekolada truskawkowa 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49 }] },
  { id: 44, name: 'Milka Caramel', description: 'Czekolada z karmelem 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49 }] },
  { id: 45, name: 'Milka Whole Nuts', description: 'Czekolada z caÅ‚ymi orzechami 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 5.49 }, { store_name: 'LIDL', price: 4.99 }] },
  { id: 46, name: 'Milka White', description: 'Czekolada biaÅ‚a 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ¤', prices: [{ store_name: 'Biedronka', price: 4.99 }, { store_name: 'LIDL', price: 4.49 }] },
  { id: 47, name: 'Milka Raisins & Nuts', description: 'Czekolada z rodzynkami i orzechami 100g', brand: 'Milka', category_id: 7, category_name: 'SÅ‚odycze', category_icon: 'ğŸ«', prices: [{ store_name: 'Biedronka', price: 5.29 }, { store_name: 'LIDL', price: 4.79 }] }
];

// 50+ Polish Stores Database
const stores = [
  // Major discount chains
  { id: 1, name: 'Biedronka', type: 'discount', website: 'https://www.biedronka.pl', categories: ['fruits', 'bread', 'dairy', 'meat', 'vegetables'], location_count: 3000, logo: 'ğŸ”´' },
  { id: 2, name: 'LIDL', type: 'discount', website: 'https://www.lidl.pl', categories: ['organic', 'bread', 'meat', 'dairy', 'fruits'], location_count: 800, logo: 'ğŸ”µ' },
  { id: 3, name: 'Netto', type: 'discount', website: 'https://www.netto.pl', categories: ['fruits', 'vegetables', 'dairy'], location_count: 400, logo: 'ğŸŸ¡' },
  { id: 4, name: 'Dino', type: 'discount', website: 'https://www.dino.pl', categories: ['local', 'fresh', 'meat', 'dairy'], location_count: 2000, logo: 'ğŸ¦•' },
  { id: 5, name: 'Stokrotka', type: 'discount', website: 'https://www.stokrotka.pl', categories: ['daily', 'fresh', 'dairy'], location_count: 700, logo: 'ğŸŒ¼' },
  { id: 6, name: 'Polomarket', type: 'discount', website: 'https://www.polomarket.pl', categories: ['local', 'meat', 'dairy'], location_count: 280, logo: 'ğŸ”·' },
  
  // Hypermarkets
  { id: 7, name: 'Carrefour', type: 'hypermarket', website: 'https://www.carrefour.pl', categories: ['food', 'electronics', 'clothing'], location_count: 90, logo: 'ğŸ›’' },
  { id: 8, name: 'Auchan', type: 'hypermarket', website: 'https://www.auchan.pl', categories: ['electronics', 'clothing', 'home', 'food'], location_count: 90, logo: 'ğŸª' },
  { id: 9, name: 'Tesco', type: 'hypermarket', website: 'https://www.tesco.pl', categories: ['food', 'household', 'electronics'], location_count: 450, logo: 'ğŸ”´' },
  { id: 10, name: 'Real', type: 'hypermarket', website: 'https://www.real.de', categories: ['food', 'household', 'clothing'], location_count: 50, logo: 'ğŸŸ¢' },
  { id: 11, name: 'Kaufland', type: 'hypermarket', website: 'https://www.kaufland.pl', categories: ['food', 'household', 'electronics'], location_count: 240, logo: 'ğŸ”´' },
  { id: 12, name: 'E.Leclerc', type: 'hypermarket', website: 'https://www.e-leclerc.pl', categories: ['food', 'electronics', 'automotive'], location_count: 25, logo: 'ğŸŸ ' },
  
  // Convenience stores
  { id: 13, name: 'Å»abka', type: 'convenience', website: 'https://www.zabka.pl', categories: ['snacks', 'drinks', 'sweets'], location_count: 8000, logo: 'ğŸ¸' },
  { id: 14, name: 'Freshmarket', type: 'convenience', website: 'https://www.freshmarket.pl', categories: ['fresh', 'daily', 'convenience'], location_count: 190, logo: 'ğŸ¥¬' },
  { id: 15, name: 'Lewiatan', type: 'convenience', website: 'https://www.lewiatan.pl', categories: ['local', 'daily', 'convenience'], location_count: 3000, logo: 'âš“' },
  { id: 16, name: 'Spar', type: 'convenience', website: 'https://www.spar.pl', categories: ['international', 'convenience'], location_count: 120, logo: 'ğŸŒŸ' },
  { id: 17, name: 'Delikatesy Centrum', type: 'convenience', website: 'https://www.dc.pl', categories: ['premium', 'delicatessen'], location_count: 350, logo: 'ğŸ’' },
  { id: 18, name: 'Intermarche', type: 'convenience', website: 'https://www.intermarche.pl', categories: ['french', 'gourmet'], location_count: 250, logo: 'ğŸ‡«ğŸ‡·' },
  
  // Drugstores
  { id: 19, name: 'Rossmann', type: 'drugstore', website: 'https://www.rossmann.pl', categories: ['hygiene', 'baby', 'household'], location_count: 1800, logo: 'ğŸ’Š' },
  { id: 20, name: 'Super-Pharm', type: 'drugstore', website: 'https://www.super-pharm.pl', categories: ['pharmacy', 'cosmetics'], location_count: 290, logo: 'ğŸ’‰' },
  { id: 21, name: 'Hebe', type: 'drugstore', website: 'https://www.hebe.pl', categories: ['cosmetics', 'perfumes'], location_count: 280, logo: 'ğŸ’„' },
  { id: 22, name: 'Doz.pl', type: 'drugstore', website: 'https://www.doz.pl', categories: ['pharmacy', 'health'], location_count: 170, logo: 'ğŸ¥' },
  
  // Furniture & Home
  { id: 23, name: 'IKEA', type: 'furniture', website: 'https://www.ikea.com/pl', categories: ['household', 'home', 'kitchen'], location_count: 15, logo: 'ğŸ ' },
  { id: 24, name: 'Leroy Merlin', type: 'home_improvement', website: 'https://www.leroymerlin.pl', categories: ['household', 'home', 'garden'], location_count: 80, logo: 'ğŸ”¨' },
  { id: 25, name: 'Castorama', type: 'home_improvement', website: 'https://www.castorama.pl', categories: ['diy', 'garden', 'tools'], location_count: 75, logo: 'ğŸ› ï¸' },
  { id: 26, name: 'OBI', type: 'home_improvement', website: 'https://www.obi.pl', categories: ['garden', 'tools', 'building'], location_count: 65, logo: 'ğŸ§°' },
  { id: 27, name: 'Jysk', type: 'furniture', website: 'https://www.jysk.pl', categories: ['furniture', 'home', 'bedding'], location_count: 180, logo: 'ğŸ›ï¸' },
  { id: 28, name: 'Black Red White', type: 'furniture', website: 'https://www.brw.pl', categories: ['furniture', 'bedroom', 'living'], location_count: 120, logo: 'âš«' },
  
  // Specialized stores
  { id: 29, name: 'Pepco', type: 'retail', website: 'https://www.pepco.pl', categories: ['clothing', 'household', 'toys'], location_count: 600, logo: 'ğŸ¯' },
  { id: 30, name: 'Action', type: 'retail', website: 'https://www.action.com/pl', categories: ['household', 'toys', 'seasonal'], location_count: 200, logo: 'ğŸ’¥' },
  { id: 31, name: 'TEDi', type: 'retail', website: 'https://www.tedi.com', categories: ['household', 'decoration', 'toys'], location_count: 180, logo: 'ğŸ§¸' },
  { id: 32, name: 'Dealz', type: 'retail', website: 'https://www.dealz.ie', categories: ['household', 'toys', 'stationery'], location_count: 50, logo: 'ğŸ’°' },
  
  // Electronics
  { id: 33, name: 'Media Markt', type: 'electronics', website: 'https://www.mediamarkt.pl', categories: ['electronics', 'appliances'], location_count: 35, logo: 'ğŸ“±' },
  { id: 34, name: 'Saturn', type: 'electronics', website: 'https://www.saturn.pl', categories: ['electronics', 'gaming'], location_count: 8, logo: 'ğŸª' },
  { id: 35, name: 'RTV Euro AGD', type: 'electronics', website: 'https://www.euro.com.pl', categories: ['electronics', 'appliances'], location_count: 350, logo: 'ğŸ“º' },
  { id: 36, name: 'Neo24', type: 'electronics', website: 'https://www.neo24.pl', categories: ['electronics', 'mobile'], location_count: 180, logo: 'ğŸ“²' },
  
  // Clothing
  { id: 37, name: 'H&M', type: 'clothing', website: 'https://www.hm.com/pl', categories: ['fashion', 'clothing'], location_count: 120, logo: 'ğŸ‘•' },
  { id: 38, name: 'Reserved', type: 'clothing', website: 'https://www.reserved.com/pl', categories: ['fashion', 'polish'], location_count: 250, logo: 'ğŸ‡µğŸ‡±' },
  { id: 39, name: 'CCC', type: 'shoes', website: 'https://www.ccc.eu', categories: ['shoes', 'accessories'], location_count: 400, logo: 'ğŸ‘Ÿ' },
  { id: 40, name: 'Deichmann', type: 'shoes', website: 'https://www.deichmann.com/pl', categories: ['shoes', 'bags'], location_count: 200, logo: 'ğŸ‘ ' },
  
  // Bookstores & Culture
  { id: 41, name: 'Empik', type: 'bookstore', website: 'https://www.empik.com', categories: ['books', 'music', 'electronics'], location_count: 250, logo: 'ğŸ“š' },
  { id: 42, name: 'Matras', type: 'bookstore', website: 'https://www.matras.pl', categories: ['books', 'stationery'], location_count: 80, logo: 'ğŸ“–' },
  
  // Sports
  { id: 43, name: 'Decathlon', type: 'sports', website: 'https://www.decathlon.pl', categories: ['sports', 'outdoor'], location_count: 50, logo: 'âš½' },
  { id: 44, name: 'Go Sport', type: 'sports', website: 'https://www.gosport.pl', categories: ['sports', 'fitness'], location_count: 45, logo: 'ğŸƒ' },
  
  // Pharmacies
  { id: 45, name: 'Apteka Gemini', type: 'pharmacy', website: 'https://www.gemini.pl', categories: ['pharmacy', 'health'], location_count: 1200, logo: 'ğŸ’Š' },
  { id: 46, name: 'Ziko Apteka', type: 'pharmacy', website: 'https://www.ziko.pl', categories: ['pharmacy', 'health'], location_count: 800, logo: 'âš•ï¸' },
  { id: 47, name: 'Apteka DOZ', type: 'pharmacy', website: 'https://www.doz.pl', categories: ['pharmacy', 'supplements'], location_count: 400, logo: 'ğŸ¥' },
  
  // Petrol stations with shops
  { id: 48, name: 'Orlen', type: 'petrol', website: 'https://www.orlen.pl', categories: ['fuel', 'convenience', 'coffee'], location_count: 2800, logo: 'â›½' },
  { id: 49, name: 'BP', type: 'petrol', website: 'https://www.bp.com/pl', categories: ['fuel', 'convenience'], location_count: 500, logo: 'ğŸŸ¢' },
  { id: 50, name: 'Shell', type: 'petrol', website: 'https://www.shell.pl', categories: ['fuel', 'convenience'], location_count: 400, logo: 'ğŸš' }
];

// Health check
app.get('/health', (req, res) => {
  res.json({
    success: true,
    message: 'GroceryCompare API Ã§alÄ±ÅŸÄ±yor!',
    timestamp: new Date().toISOString(),
    version: '2.0.0',
    environment: 'demo',
    total_products: sampleProducts.length,
    total_stores: stores.length
  });
});

// Root endpoint
app.get('/', (req, res) => {
  res.json({
    success: true,
    message: 'HoÅŸ geldiniz - GroceryCompare Poland API',
    description: 'Polonya iÃ§in akÄ±llÄ± market fiyat karÅŸÄ±laÅŸtÄ±rma platformu',
    version: '2.0.0',
    features: ['24 Polish products', '9 store chains', 'Real-time price comparison', 'AI recommendations'],
    endpoints: {
      health: '/health',
      products: '/api/products',
      stores: '/api/stores',
      categories: '/api/products/categories'
    }
  });
});

// Products API
app.get('/api/products', (req, res) => {
  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 12;
  const category = req.query.category;
  const search = req.query.search;

  let filteredProducts = [...sampleProducts];

  // Filter by category
  if (category) {
    filteredProducts = filteredProducts.filter(product => 
      product.category_id === parseInt(category) || 
      product.category_name.toLowerCase().includes(category.toLowerCase())
    );
  }

  // Filter by search
  if (search) {
    filteredProducts = filteredProducts.filter(product => 
      product.name.toLowerCase().includes(search.toLowerCase()) ||
      product.brand.toLowerCase().includes(search.toLowerCase()) ||
      product.description.toLowerCase().includes(search.toLowerCase())
    );
  }

  const total = filteredProducts.length;
  const startIndex = (page - 1) * limit;
  const paginatedProducts = filteredProducts.slice(startIndex, startIndex + limit);

  res.json({
    success: true,
    message: 'Produkty pobrane pomyÅ›lnie',
    data: paginatedProducts,
    meta: {
      page,
      limit,
      total,
      totalPages: Math.ceil(total / limit),
      hasNext: startIndex + limit < total,
      hasPrev: page > 1
    }
  });
});

app.get('/api/products/:id', (req, res) => {
  const productId = parseInt(req.params.id);
  const product = sampleProducts.find(p => p.id === productId);
  
  if (!product) {
    return res.status(404).json({
      success: false,
      error: 'Produkt nie zostaÅ‚ znaleziony'
    });
  }

  res.json({
    success: true,
    message: 'Produkt pobrany pomyÅ›lnie',
    data: product
  });
});

app.get('/api/products/:id/prices', (req, res) => {
  const productId = parseInt(req.params.id);
  const product = sampleProducts.find(p => p.id === productId);
  
  if (!product) {
    return res.status(404).json({
      success: false,
      error: 'Produkt nie zostaÅ‚ znaleziony'
    });
  }

  const prices = product.prices.map(price => ({
    ...price,
    store_id: stores.find(s => s.name === price.store_name)?.id || 1,
    in_stock: Math.random() > 0.1, // 90% chance in stock
    last_updated: new Date().toISOString()
  }));

  const allPrices = prices.map(p => p.price);
  const cheapestPrice = Math.min(...allPrices);
  const mostExpensivePrice = Math.max(...allPrices);
  const averagePrice = allPrices.reduce((sum, price) => sum + price, 0) / allPrices.length;
  const bestDealStore = prices.find(p => p.price === cheapestPrice)?.store_name || '';

  res.json({
    success: true,
    message: 'PorÃ³wnanie cen produktu pobrane pomyÅ›lnie',
    data: {
      product_id: product.id,
      product_name: product.name,
      product_image: product.image_url,
      category: product.category_name,
      brand: product.brand,
      prices,
      cheapest_price: cheapestPrice,
      most_expensive_price: mostExpensivePrice,
      average_price: Math.round(averagePrice * 100) / 100,
      price_difference: Math.round((mostExpensivePrice - cheapestPrice) * 100) / 100,
      savings_percentage: Math.round(((mostExpensivePrice - cheapestPrice) / mostExpensivePrice) * 100),
      best_deal_store: bestDealStore,
      total_stores: prices.length
    }
  });
});

// Stores API
app.get('/api/stores', (req, res) => {
  const type = req.query.type;
  let filteredStores = [...stores];

  if (type) {
    filteredStores = filteredStores.filter(store => store.type === type);
  }

  res.json({
    success: true,
    message: 'Sklepy pobrane pomyÅ›lnie',
    data: filteredStores,
    meta: {
      total: filteredStores.length,
      types: [...new Set(stores.map(s => s.type))]
    }
  });
});

app.get('/api/stores/:id', (req, res) => {
  const storeId = parseInt(req.params.id);
  const store = stores.find(s => s.id === storeId);
  
  if (!store) {
    return res.status(404).json({
      success: false,
      error: 'Sklep nie zostaÅ‚ znaleziony'
    });
  }

  // Get products available in this store
  const storeProducts = sampleProducts.filter(product => 
    product.prices.some(price => price.store_name === store.name)
  );

  res.json({
    success: true,
    message: 'Sklep pobrany pomyÅ›lnie',
    data: {
      ...store,
      available_products: storeProducts.length,
      sample_products: storeProducts.slice(0, 5)
    }
  });
});

// Categories with enhanced data
app.get('/api/products/categories', (req, res) => {
  const categories = [
    { id: 1, name: 'bread', name_pl: 'Pieczywo', icon: 'ğŸ', product_count: 2 },
    { id: 2, name: 'dairy', name_pl: 'NabiaÅ‚', icon: 'ğŸ¥›', product_count: 3 },
    { id: 3, name: 'meat', name_pl: 'MiÄ™so i ryby', icon: 'ğŸ¥©', product_count: 2 },
    { id: 4, name: 'vegetables', name_pl: 'Warzywa', icon: 'ğŸ¥•', product_count: 3 },
    { id: 5, name: 'fruits', name_pl: 'Owoce', icon: 'ğŸ', product_count: 2 },
    { id: 6, name: 'drinks', name_pl: 'Napoje', icon: 'ğŸ¥¤', product_count: 2 },
    { id: 7, name: 'sweets', name_pl: 'SÅ‚odycze', icon: 'ğŸ­', product_count: 1 },
    { id: 8, name: 'snacks', name_pl: 'PrzekÄ…ski', icon: 'ğŸ¿', product_count: 1 },
    { id: 9, name: 'frozen', name_pl: 'MroÅ¼onki', icon: 'ğŸ§Š', product_count: 1 },
    { id: 10, name: 'spices', name_pl: 'Przyprawy', icon: 'ğŸ§‚', product_count: 1 },
    { id: 11, name: 'household', name_pl: 'Chemia gospodarcza', icon: 'ğŸ§½', product_count: 3 },
    { id: 12, name: 'hygiene', name_pl: 'Higiena osobista', icon: 'ğŸ§´', product_count: 1 },
    { id: 13, name: 'baby', name_pl: 'ArtykuÅ‚y dla dzieci', icon: 'ğŸ¼', product_count: 1 }
  ];

  res.json({
    success: true,
    message: 'Kategorie produktÃ³w pobrane pomyÅ›lnie',
    data: categories,
    meta: {
      total: categories.length,
      total_products: sampleProducts.length
    }
  });
});

// New: Search endpoint
app.get('/api/search', (req, res) => {
  const query = req.query.q;
  if (!query) {
    return res.status(400).json({
      success: false,
      error: 'Query parameter required'
    });
  }

  const searchResults = sampleProducts.filter(product => 
    product.name.toLowerCase().includes(query.toLowerCase()) ||
    product.brand.toLowerCase().includes(query.toLowerCase()) ||
    product.description.toLowerCase().includes(query.toLowerCase())
  );

  res.json({
    success: true,
    message: `Znaleziono ${searchResults.length} produktÃ³w`,
    data: searchResults,
    meta: {
      query,
      total: searchResults.length
    }
  });
});

// New: Trending/Popular products
app.get('/api/products/trending', (req, res) => {
  // Simulate trending by selecting products with promotions or random selection
  const trending = sampleProducts
    .filter(product => product.prices.some(price => price.is_promotion))
    .slice(0, 8);

  res.json({
    success: true,
    message: 'Popularne produkty pobrane pomyÅ›lnie',
    data: trending,
    meta: {
      total: trending.length
    }
  });
});

// Start server
app.listen(PORT, () => {
  console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       ğŸ›’ GroceryCompare Poland API v2.0       â•‘
â•‘                 EXPANDED DEMO                â•‘
â•‘                                              â•‘
â•‘  ğŸš€ Server: http://localhost:${PORT}           â•‘
â•‘  â¤ï¸  Health: http://localhost:${PORT}/health     â•‘
â•‘                                              â•‘
â•‘  ğŸ“Š ${sampleProducts.length} Products | ${stores.length} Stores                    â•‘
â•‘  ğŸª IKEA, Rossmann, Leroy Merlin added      â•‘
â•‘  ğŸ’° Real Polish prices & promotions         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  `);
}); 